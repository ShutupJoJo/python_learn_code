2024-08-08 17:02:14.668 | ERROR    | fastapi.routing:run_endpoint_function:191 - An error has been caught in function 'run_endpoint_function', process 'SpawnProcess-1' (6504), thread 'MainThread' (18156):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x000001EE1EE82FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x000001EE1EDE0860>
           └ <SpawnProcess name='SpawnProcess-1' parent=20692 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001EE1EDD7D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=20692 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001EE1EE715E0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20692 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20692 started>
    │    └ <function subprocess_started at 0x000001EE211C5DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20692 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=676, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001EE21305490>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=676, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001EE211C53A0>
           │       │   └ <uvicorn.server.Server object at 0x000001EE21305490>
           │       └ <function run at 0x000001EE209D62A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001EE213091C0>
           │      └ <function Runner.run at 0x000001EE20AA0FE0>
           └ <asyncio.runners.Runner object at 0x000001EE20B19FD0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001EE20A9EC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001EE20B19FD0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001EE20A9EB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001EE20AA09A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001EE209D6FC0>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x000001EE23418DF0>()>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x000001EE23418DF0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x000001EE23418DF0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x000001EE23418DF0>()>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001EE213349E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001EE23...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001EE233CEF00>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001EE213349E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001EE23...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001EE23...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001EE233E59A0>
          └ <fastapi.applications.FastAPI object at 0x000001EE233CEF00>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001EE2341D120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001EE233E49E0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001EE233E59A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001EE2341D120>
          │                            │    │    │     │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001EE23418E60>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001EE232E8830>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001EE233E49E0>
          └ <function wrap_app_handling_exceptions at 0x000001EE232E2840>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EE2341D300>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001EE232E8830>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EE2341D300>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001EE232E8830>>
          └ <fastapi.routing.APIRouter object at 0x000001EE232E8830>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EE2341D300>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001EE232E3C40>
          └ APIRoute(path='/', name='root', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EE2341D300>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001EE233F13A0>
          └ APIRoute(path='/', name='root', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EE2341D300>
          │                            │    │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001EE21352210>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001EE2341D3A0>
          └ <function wrap_app_handling_exceptions at 0x000001EE232E2840>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EE2341D4E0>
          │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001EE2341D3A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001EE21352210>
                     └ <function get_request_handler.<locals>.app at 0x000001EE233F1580>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001EE232E2020>
> File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function root at 0x000001EE233F1080>
                 └ <fastapi.dependencies.models.Dependant object at 0x000001EE1EA9C440>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\main.py", line 20, in root
    c = a/b
        │ └ 0
        └ 1

ZeroDivisionError: division by zero
2024-08-10 22:06:59.817 | ERROR    | hooks.middlewares:log_middleware:14 - 发生异常了！
Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 105, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x00000220C2EE3CE0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 100, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    return receiver.item
           └ <unprintable MemoryObjectItemReceiver object>

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000220C2EE3D80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 120, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x00000220C0A32FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x00000220C0990860>
           └ <SpawnProcess name='SpawnProcess-1' parent=30524 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000220C0987D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=30524 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000220C0A21460>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=30524 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=30524 started>
    │    └ <function subprocess_started at 0x00000220C2DD1DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=30524 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=440, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000220C2F19100>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=440, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000220C2DD13A0>
           │       │   └ <uvicorn.server.Server object at 0x00000220C2F19100>
           │       └ <function run at 0x00000220C25A62A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000220C2F151C0>
           │      └ <function Runner.run at 0x00000220C2680FE0>
           └ <asyncio.runners.Runner object at 0x00000220C2DD7140>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000220C267EC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000220C2DD7140>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000220C267EB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000220C26809A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000220C25A6FC0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000220C2DD41D0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000220C5...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000220C2E2E960>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000220C2DD41D0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000220C5...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x00000220C5...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000220C5B43CE0>
          └ <fastapi.applications.FastAPI object at 0x00000220C2E2E960>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000220C5B77E20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000220C5B43B30>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000220C5B43CE0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000220C5BE0EA0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000220C5BCDD60>
                     │    └ <function log_middleware at 0x00000220C51C6CA0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000220C5B43B30>

> File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\hooks\middlewares.py", line 9, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x00000220C5BCDD60>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000220C5BE0EA0>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
          └ <AioRpcError of RPC that terminated with:
            	status = StatusCode.UNIMPLEMENTED
            	details = "Method not found!"
            	debug_error_stri...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000220C5BE0E00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000220C5BE1300>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000220C55D17F0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000220C5B43B30>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000220C5BE0E00>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000220C5BE1300>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000220C5BCE090>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000220C4F8BC80>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000220C55D17F0>
          └ <function wrap_app_handling_exceptions at 0x00000220C4EF28E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000220C5BE1940>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000220C5BE1300>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000220C4F8BC80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000220C5BE1940>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000220C5BE1300>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000220C4F8BC80>>
          └ <fastapi.routing.APIRouter object at 0x00000220C4F8BC80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000220C5BE1940>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000220C5BE1300>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000220C4EF3CE0>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000220C5BE1940>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000220C5BE1300>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000220C5B74C20>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000220C5BE1940>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000220C5BE1300>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000220C5BCE300>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000220C5BE19E0>
          └ <function wrap_app_handling_exceptions at 0x00000220C4EF28E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000220C5BE1B20>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000220C5BE1300>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000220C5BE19E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x00000220C5BCE300>
                     └ <function get_request_handler.<locals>.app at 0x00000220C5B74B80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000220C4EF20C0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'data': LoginModel(mobile='18570631587', code='3190')}
                 │         └ <function login at 0x00000220C5B52DE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000220C5B78050>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\routers\user.py", line 52, in login
    user = await user_service_client.get_or_create_user_by_mobile(mobile)
                 │                   │                            └ '18570631587'
                 │                   └ <function UserServiceClient.get_or_create_user_by_mobile at 0x00000220C5B52200>
                 └ <services.user.UserServiceClient object at 0x00000220C5B401D0>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\services\user.py", line 24, in get_or_create_user_by_mobile
    response = await stub.GetOrCreateUserByMobile(request)
                     │    │                       └ mobile: "18570631587"
                     │    │                         
                     │    └ <grpc.aio._channel.UnaryUnaryMultiCallable object at 0x00000220C5BCEBA0>
                     └ <services.protos.user_pb2_grpc.UserStub object at 0x00000220C5BCE810>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\grpc\aio\_call.py", line 327, in __await__
    raise _create_rpc_error(
          └ <function _create_rpc_error at 0x00000220C59D3420>

grpc.aio._call.AioRpcError: <AioRpcError of RPC that terminated with:
	status = StatusCode.UNIMPLEMENTED
	details = "Method not found!"
	debug_error_string = "UNKNOWN:Error received from peer  {grpc_message:"Method not found!", grpc_status:12, created_time:"2024-08-10T14:06:59.8075449+00:00"}"
>
2024-08-10 22:08:22.116 | ERROR    | hooks.middlewares:log_middleware:14 - 发生异常了！
Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 105, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000021AEF213CE0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 100, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    return receiver.item
           └ <unprintable MemoryObjectItemReceiver object>

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000021AEF213D80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 120, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 360
               │     └ 3
               └ <function _main at 0x0000021AECD22FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 360
           │    └ <function BaseProcess._bootstrap at 0x0000021AECC80860>
           └ <SpawnProcess name='SpawnProcess-1' parent=36464 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000021AECC77D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=36464 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000021AECCE14C0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=36464 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=36464 started>
    │    └ <function subprocess_started at 0x0000021AEF105DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=36464 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=724, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000021AEF2452E0>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=724, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000021AEF1053A0>
           │       │   └ <uvicorn.server.Server object at 0x0000021AEF2452E0>
           │       └ <function run at 0x0000021AEE8D62A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000021AEF2491C0>
           │      └ <function Runner.run at 0x0000021AEE9B0FE0>
           └ <asyncio.runners.Runner object at 0x0000021AEF07E540>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000021AEE9AEC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000021AEF07E540>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000021AEE9AEB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000021AEE9B09A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000021AEE8D6FC0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021AEF291E80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021AF1...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000021AEF420890>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000021AEF291E80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021AF1...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021AF1...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021AF1EA2510>
          └ <fastapi.applications.FastAPI object at 0x0000021AEF420890>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000021AF1E9FCE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000021...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000021AF1E86900>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000021AF1EA2510>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021AF1E9FE20>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000021AF1ECC3E0>
                     │    └ <function log_middleware at 0x0000021AF14F6CA0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000021AF1E86900>

> File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\hooks\middlewares.py", line 9, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000021AF1ECC3E0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000021AF1E9FE20>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
          └ <AioRpcError of RPC that terminated with:
            	status = StatusCode.UNIMPLEMENTED
            	details = "Method not found!"
            	debug_error_stri...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021AF1ED7740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021AF1E9FEC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021AF1E86930>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000021AF1E86900>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000021AF1ED7740>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021AF1E9FEC0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000021AF1EA2330>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000021AF14F1FD0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000021AF1E86930>
          └ <function wrap_app_handling_exceptions at 0x0000021AF12228E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021AF1F0D080>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021AF1E9FEC0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000021AF14F1FD0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021AF1F0D080>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021AF1E9FEC0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000021AF14F1FD0>>
          └ <fastapi.routing.APIRouter object at 0x0000021AF14F1FD0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021AF1F0D080>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021AF1E9FEC0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000021AF1223CE0>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021AF1F0D080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021AF1E9FEC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000021AF1E9CC20>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021AF1F0D080>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021AF1E9FEC0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000021AF1EFD610>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000021AF1F0D120>
          └ <function wrap_app_handling_exceptions at 0x0000021AF12228E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000021AF1F0D260>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000021AF1E9FEC0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000021AF1F0D120>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000021AF1EFD610>
                     └ <function get_request_handler.<locals>.app at 0x0000021AF1E9CB80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000021AF12220C0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'data': LoginModel(mobile='18570631587', code='3190')}
                 │         └ <function login at 0x0000021AF1E7ADE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000021AF1EA0080>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\routers\user.py", line 52, in login
    user = await user_service_client.get_or_create_user_by_mobile(mobile)
                 │                   │                            └ '18570631587'
                 │                   └ <function UserServiceClient.get_or_create_user_by_mobile at 0x0000021AF1E7A200>
                 └ <services.user.UserServiceClient object at 0x0000021AF1E85280>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\services\user.py", line 24, in get_or_create_user_by_mobile
    response = await stub.GetOrCreateUserByMobile(request)
                     │    │                       └ mobile: "18570631587"
                     │    │                         
                     │    └ <grpc.aio._channel.UnaryUnaryMultiCallable object at 0x0000021AF1EFE1E0>
                     └ <services.protos.user_pb2_grpc.UserStub object at 0x0000021AF1E871D0>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\grpc\aio\_call.py", line 327, in __await__
    raise _create_rpc_error(
          └ <function _create_rpc_error at 0x0000021AF1D03420>

grpc.aio._call.AioRpcError: <AioRpcError of RPC that terminated with:
	status = StatusCode.UNIMPLEMENTED
	details = "Method not found!"
	debug_error_string = "UNKNOWN:Error received from peer  {grpc_message:"Method not found!", grpc_status:12, created_time:"2024-08-10T14:08:22.1062052+00:00"}"
>
2024-08-10 22:09:08.632 | ERROR    | hooks.middlewares:log_middleware:14 - 发生异常了！
Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 105, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001246C583CE0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 100, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    return receiver.item
           └ <unprintable MemoryObjectItemReceiver object>

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001246C583D80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 120, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 352
               │     └ 3
               └ <function _main at 0x000001246A092FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 352
           │    └ <function BaseProcess._bootstrap at 0x0000012469FF0860>
           └ <SpawnProcess name='SpawnProcess-1' parent=3740 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000012469FE7D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=3740 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001246A0514C0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=3740 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=3740 started>
    │    └ <function subprocess_started at 0x000001246C475DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=3740 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=368, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001246C5B5400>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=368, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001246C4753A0>
           │       │   └ <uvicorn.server.Server object at 0x000001246C5B5400>
           │       └ <function run at 0x000001246BC462A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001246C5B91C0>
           │      └ <function Runner.run at 0x000001246BD20FE0>
           └ <asyncio.runners.Runner object at 0x000001246A0815E0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001246BD1EC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001246A0815E0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001246BD1EB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001246BD209A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001246BC46FC0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001246C7983E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001246F...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000012...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001246C798680>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001246C7983E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001246F...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000012...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001246F...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000012...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001246F1F7C80>
          └ <fastapi.applications.FastAPI object at 0x000001246C798680>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001246F213CE0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000012...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001246F1F7CE0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001246F1F7C80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001246F213E20>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001246F217FE0>
                     │    └ <function log_middleware at 0x000001246E866CA0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001246F1F7CE0>

> File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\hooks\middlewares.py", line 9, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001246F217FE0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001246F213E20>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
          └ <AioRpcError of RPC that terminated with:
            	status = StatusCode.UNIMPLEMENTED
            	details = "Method not found!"
            	debug_error_stri...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001246F247740>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001246F213EC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001246F1F6C90>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001246F1F7CE0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001246F247740>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001246F213EC0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001246F23D4F0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001246E6954C0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001246F1F6C90>
          └ <function wrap_app_handling_exceptions at 0x000001246E5928E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001246F27D080>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001246F213EC0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001246E6954C0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001246F27D080>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001246F213EC0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001246E6954C0>>
          └ <fastapi.routing.APIRouter object at 0x000001246E6954C0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001246F27D080>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001246F213EC0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001246E593CE0>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001246F27D080>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001246F213EC0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001246F210C20>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001246F27D080>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001246F213EC0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001246F26D460>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001246F27D120>
          └ <function wrap_app_handling_exceptions at 0x000001246E5928E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001246F27D260>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001246F213EC0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001246F27D120>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001246F26D460>
                     └ <function get_request_handler.<locals>.app at 0x000001246F210B80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001246E5920C0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'data': LoginModel(mobile='18570631587', code='3190')}
                 │         └ <function login at 0x000001246F1EADE0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000001246F214110>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\routers\user.py", line 52, in login
    user = await user_service_client.get_or_create_user_by_mobile(mobile)
                 │                   │                            └ '18570631587'
                 │                   └ <function UserServiceClient.get_or_create_user_by_mobile at 0x000001246F1EA200>
                 └ <services.user.UserServiceClient object at 0x000001246F1F5340>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\services\user.py", line 24, in get_or_create_user_by_mobile
    response = await stub.GetOrCreateUserByMobile(request)
                     │    │                       └ mobile: "18570631587"
                     │    │                         
                     │    └ <grpc.aio._channel.UnaryUnaryMultiCallable object at 0x000001246F26E030>
                     └ <services.protos.user_pb2_grpc.UserStub object at 0x000001246F26DA90>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\grpc\aio\_call.py", line 327, in __await__
    raise _create_rpc_error(
          └ <function _create_rpc_error at 0x000001246F073420>

grpc.aio._call.AioRpcError: <AioRpcError of RPC that terminated with:
	status = StatusCode.UNIMPLEMENTED
	details = "Method not found!"
	debug_error_string = "UNKNOWN:Error received from peer  {created_time:"2024-08-10T14:09:08.6145622+00:00", grpc_status:12, grpc_message:"Method not found!"}"
>
2024-08-11 13:26:02.028 | ERROR    | hooks.middlewares:log_middleware:14 - 发生异常了！
Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 105, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001A337B03CE0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 100, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    return receiver.item
           └ <unprintable MemoryObjectItemReceiver object>

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001A337B03D80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 120, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 464
               │     └ 3
               └ <function _main at 0x000001A335672FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 464
           │    └ <function BaseProcess._bootstrap at 0x000001A3355D0860>
           └ <SpawnProcess name='SpawnProcess-1' parent=12452 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001A3355C7D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=12452 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001A335661580>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=12452 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=12452 started>
    │    └ <function subprocess_started at 0x000001A3379F1DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=12452 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=364, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001A337B35340>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=364, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001A3379F13A0>
           │       │   └ <uvicorn.server.Server object at 0x000001A337B35340>
           │       └ <function run at 0x000001A3371C62A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001A337B391C0>
           │      └ <function Runner.run at 0x000001A3372A0FE0>
           └ <asyncio.runners.Runner object at 0x000001A33796E4B0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001A33729EC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001A33796E4B0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001A33729EB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001A3372A09A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001A3371C6FC0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001A337B37D40>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A33A...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001A337D18650>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001A337B37D40>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A33A...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A33A...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001A33A773F20>
          └ <fastapi.applications.FastAPI object at 0x000001A337D18650>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001A33A7BC2C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001A33A7732C0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001A33A773F20>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001A33A76A7A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001A33A7B8770>
                     │    └ <function log_middleware at 0x000001A339DE2CA0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001A33A7732C0>

> File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\hooks\middlewares.py", line 9, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001A33A7B8770>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001A33A76A7A0>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
          └ ConnectionError("Error Multiple exceptions: [Errno 10061] Connect call failed ('::1', 6379, 0, 0), [Errno 10061] Connect call...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001A33A7BFB00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001A33A7BC4A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001A33A773A70>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001A33A7732C0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001A33A7BFB00>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001A33A7BC4A0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001A33A7B9B80>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001A339C161B0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001A33A773A70>
          └ <function wrap_app_handling_exceptions at 0x000001A339B128E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001A33A7FD3A0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001A33A7BC4A0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001A339C161B0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001A33A7FD3A0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001A33A7BC4A0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001A339C161B0>>
          └ <fastapi.routing.APIRouter object at 0x000001A339C161B0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001A33A7FD3A0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001A33A7BC4A0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001A339B13CE0>
          └ APIRoute(path='/user/smscode/{mobile}', name='get_smscode', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001A33A7FD3A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001A33A7BC4A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001A33A790900>
          └ APIRoute(path='/user/smscode/{mobile}', name='get_smscode', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001A33A7FD3A0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001A33A7BC4A0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001A33A57C140>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001A33A7FD440>
          └ <function wrap_app_handling_exceptions at 0x000001A339B128E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001A33A7FD580>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001A33A7BC4A0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001A33A7FD440>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001A33A57C140>
                     └ <function get_request_handler.<locals>.app at 0x000001A33A790860>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001A339B120C0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'mobile': '18570631587'}
                 │         └ <function get_smscode at 0x000001A33A723240>
                 └ <fastapi.dependencies.models.Dependant object at 0x000001A33A772450>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\routers\user.py", line 27, in get_smscode
    await tll_redis.set_sms_code(mobile, code)
          │         │            │       └ '1284'
          │         │            └ '18570631587'
          │         └ <function TLLRedis.set_sms_code at 0x000001A339DE16C0>
          └ <utils.cache.TLLRedis object at 0x000001A33A679970>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\utils\cache.py", line 21, in set_sms_code
    await self.set(self.SMS_CODE_PREFIX.format(mobile), code)
          │    │   │    │               │      │        └ '1284'
          │    │   │    │               │      └ '18570631587'
          │    │   │    │               └ <method 'format' of 'str' objects>
          │    │   │    └ 'sms_code_{}'
          │    │   └ <utils.cache.TLLRedis object at 0x000001A33A679970>
          │    └ <function TLLRedis.set at 0x000001A339C0DF80>
          └ <utils.cache.TLLRedis object at 0x000001A33A679970>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\utils\cache.py", line 12, in set
    await self.client.set(key, value, ex)
          │    │      │   │    │      └ 18000
          │    │      │   │    └ '1284'
          │    │      │   └ 'sms_code_18570631587'
          │    │      └ <function BasicKeyCommands.set at 0x000001A339D5D9E0>
          │    └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port...
          └ <utils.cache.TLLRedis object at 0x000001A33A679970>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\client.py", line 610, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
           │    │                   │    │              │               └ {}
           │    │                   │    │              └ 'SET'
           │    │                   │    └ <function ConnectionPool.get_connection at 0x000001A339CBB9C0>
           │    │                   └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>)>
           │    └ None
           └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 1049, in get_connection
    await self.ensure_connection(connection)
          │    │                 └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          │    └ <function ConnectionPool.ensure_connection at 0x000001A339CBBC40>
          └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 1082, in ensure_connection
    await connection.connect()
          │          └ <function AbstractConnection.connect at 0x000001A339CB9EE0>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 284, in connect
    raise ConnectionError(self._error_message(e))
          │               │    └ <function AbstractConnection._error_message at 0x000001A339CBA0C0>
          │               └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          └ <class 'redis.exceptions.ConnectionError'>

redis.exceptions.ConnectionError: Error Multiple exceptions: [Errno 10061] Connect call failed ('::1', 6379, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 6379) connecting to localhost:6379.
2024-08-12 15:20:56.159 | ERROR    | fastapi.routing:run_endpoint_function:191 - An error has been caught in function 'run_endpoint_function', process 'SpawnProcess-1' (36752), thread 'MainThread' (26464):
Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 348
               │     └ 3
               └ <function _main at 0x0000022671272FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 348
           │    └ <function BaseProcess._bootstrap at 0x00000226711D0860>
           └ <SpawnProcess name='SpawnProcess-1' parent=8972 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000226711C7D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=8972 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x00000226712314F0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=8972 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=8972 started>
    │    └ <function subprocess_started at 0x0000022673625DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=8972 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x00000226737652E0>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=412, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x00000226736253A0>
           │       │   └ <uvicorn.server.Server object at 0x00000226737652E0>
           │       └ <function run at 0x0000022672DF62A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002267376D1C0>
           │      └ <function Runner.run at 0x0000022672ED0FE0>
           └ <asyncio.runners.Runner object at 0x000002267359E990>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000022672ECEC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002267359E990>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000022672ECEB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000022672ED09A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022672DF6FC0>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x0000022676B7E9E0>()>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x0000022676B7E9E0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x0000022676B7E9E0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x0000022676B7E9E0>()>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000022676EFE660>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000022676B4AE80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000022676807410>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000226734FF6E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000022676EFE660>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000022676B4AE80>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000022676B7CF50>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000022676A3F0B0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000022676807410>
          └ <function wrap_app_handling_exceptions at 0x0000022675769B20>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022676F10040>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000022676B4AE80>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000022676A3F0B0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022676F10040>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000022676B4AE80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000022676A3F0B0>>
          └ <fastapi.routing.APIRouter object at 0x0000022676A3F0B0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022676F10040>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000022676B4AE80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002267576AF20>
          └ APIRoute(path='/', name='root', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022676F10040>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000022676B4AE80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000022676B0C5E0>
          └ APIRoute(path='/', name='root', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022676F10040>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000022676B4AE80>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000022676F00F50>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000022676F100E0>
          └ <function wrap_app_handling_exceptions at 0x0000022675769B20>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022676F10220>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000022676B4AE80>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000022676F100E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000022676F00F50>
                     └ <function get_request_handler.<locals>.app at 0x0000022676B0C0E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000022675769300>
> File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function root at 0x0000022676B0D4E0>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000022676B41220>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\main.py", line 24, in root
    c = a/b
        │ └ 0
        └ 1

ZeroDivisionError: division by zero
2024-08-13 19:56:22.474 | ERROR    | hooks.middlewares:log_middleware:14 - 发生异常了！
Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 105, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000015408F23CE0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 100, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    return receiver.item
           └ <unprintable MemoryObjectItemReceiver object>

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000015408F23D80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 120, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 460
               │     └ 3
               └ <function _main at 0x0000015406A42FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 460
           │    └ <function BaseProcess._bootstrap at 0x00000154069A4860>
           └ <SpawnProcess name='SpawnProcess-1' parent=8080 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x0000015406997D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=8080 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000015406A318B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=8080 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=8080 started>
    │    └ <function subprocess_started at 0x0000015408E15DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=8080 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=392, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000015408F55670>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=392, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000015408E153A0>
           │       │   └ <uvicorn.server.Server object at 0x0000015408F55670>
           │       └ <function run at 0x00000154085E62A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000015408F591C0>
           │      └ <function Runner.run at 0x00000154086C0FE0>
           └ <asyncio.runners.Runner object at 0x0000015406A31AF0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000154086BEC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000015406A31AF0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000154086BEB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000154086C09A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000154085E6FC0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000015409130950>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001540C...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000015408E13230>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000015409130950>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001540C...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001540C...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001540C1EC4A0>
          └ <fastapi.applications.FastAPI object at 0x0000015408E13230>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000015408F4F4C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000015...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001540B86E5A0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001540C1EC4A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001540C2F7B00>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001540C36B350>
                     │    └ <function log_middleware at 0x000001540B231F80>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001540B86E5A0>

> File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\hooks\middlewares.py", line 9, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001540C36B350>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001540C2F7B00>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
          └ ConnectionError("Error Multiple exceptions: [Errno 10061] Connect call failed ('::1', 6379, 0, 0), [Errno 10061] Connect call...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001540C2F4B80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001540C2F4AE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001540BFFB170>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001540B86E5A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001540C2F4B80>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001540C2F4AE0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001540C36B620>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001540B05C9B0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001540BFFB170>
          └ <function wrap_app_handling_exceptions at 0x000001540AF59A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001540C398C20>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001540C2F4AE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001540B05C9B0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001540C398C20>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001540C2F4AE0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001540B05C9B0>>
          └ <fastapi.routing.APIRouter object at 0x000001540B05C9B0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001540C398C20>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001540C2F4AE0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001540AF5AE80>
          └ APIRoute(path='/user/smscode/{mobile}', name='get_smscode', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001540C398C20>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001540C2F4AE0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001540C2F6700>
          └ APIRoute(path='/user/smscode/{mobile}', name='get_smscode', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001540C398C20>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001540C2F4AE0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001540C36B7A0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001540C398CC0>
          └ <function wrap_app_handling_exceptions at 0x000001540AF59A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001540C398900>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001540C2F4AE0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001540C398CC0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001540C36B7A0>
                     └ <function get_request_handler.<locals>.app at 0x000001540C2F6660>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001540AF59260>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'mobile': '18899990000'}
                 │         └ <function get_smscode at 0x000001540C2C0C20>
                 └ <fastapi.dependencies.models.Dependant object at 0x000001540C2EEBD0>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\routers\user.py", line 26, in get_smscode
    await tll_redis.set_sms_code(mobile, code)
          │         │            │       └ '2563'
          │         │            └ '18899990000'
          │         └ <function TLLRedis.set_sms_code at 0x000001540B2309A0>
          └ <utils.cache.TLLRedis object at 0x000001540B2FF590>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\utils\cache.py", line 21, in set_sms_code
    await self.set(self.SMS_CODE_PREFIX.format(mobile), code)
          │    │   │    │               │      │        └ '2563'
          │    │   │    │               │      └ '18899990000'
          │    │   │    │               └ <method 'format' of 'str' objects>
          │    │   │    └ 'sms_code_{}'
          │    │   └ <utils.cache.TLLRedis object at 0x000001540B2FF590>
          │    └ <function TLLRedis.set at 0x000001540B047E20>
          └ <utils.cache.TLLRedis object at 0x000001540B2FF590>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\utils\cache.py", line 12, in set
    await self.client.set(key, value, ex)
          │    │      │   │    │      └ 18000
          │    │      │   │    └ '2563'
          │    │      │   └ 'sms_code_18899990000'
          │    │      └ <function BasicKeyCommands.set at 0x000001540B1B4CC0>
          │    └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port...
          └ <utils.cache.TLLRedis object at 0x000001540B2FF590>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\client.py", line 610, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
           │    │                   │    │              │               └ {}
           │    │                   │    │              └ 'SET'
           │    │                   │    └ <function ConnectionPool.get_connection at 0x000001540B0FACA0>
           │    │                   └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>)>
           │    └ None
           └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 1049, in get_connection
    await self.ensure_connection(connection)
          │    │                 └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          │    └ <function ConnectionPool.ensure_connection at 0x000001540B0FAF20>
          └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 1082, in ensure_connection
    await connection.connect()
          │          └ <function AbstractConnection.connect at 0x000001540B0F9080>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 284, in connect
    raise ConnectionError(self._error_message(e))
          │               │    └ <function AbstractConnection._error_message at 0x000001540B0F9260>
          │               └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          └ <class 'redis.exceptions.ConnectionError'>

redis.exceptions.ConnectionError: Error Multiple exceptions: [Errno 10061] Connect call failed ('::1', 6379, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 6379) connecting to localhost:6379.
2024-08-13 20:26:07.802 | ERROR    | hooks.middlewares:log_middleware:14 - 发生异常了！
Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 105, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001FD323C3CE0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 100, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    return receiver.item
           └ <unprintable MemoryObjectItemReceiver object>

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001FD323C3D80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 120, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 408
               │     └ 3
               └ <function _main at 0x000001FD2FF72FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 408
           │    └ <function BaseProcess._bootstrap at 0x000001FD2FED4860>
           └ <SpawnProcess name='SpawnProcess-1' parent=25184 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001FD2FEC7D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=25184 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001FD2FF61880>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=25184 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=25184 started>
    │    └ <function subprocess_started at 0x000001FD322B5DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=25184 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=348, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001FD323F5400>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=348, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001FD322B53A0>
           │       │   └ <uvicorn.server.Server object at 0x000001FD323F5400>
           │       └ <function run at 0x000001FD31AC62A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001FD323F91C0>
           │      └ <function Runner.run at 0x000001FD31B90FE0>
           └ <asyncio.runners.Runner object at 0x000001FD3222E990>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001FD31B8EC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001FD3222E990>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001FD31B8EB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001FD31B909A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001FD31AC6FC0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001FD325D0800>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001FD34...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001F...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001FD325D0AA0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001FD325D0800>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001FD34...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001F...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001FD34...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001F...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001FD34F8C290>
          └ <fastapi.applications.FastAPI object at 0x000001FD325D0AA0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001FD357CB9C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001F...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001FD3571F1D0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001FD34F8C290>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001FD357CBA60>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001FD357F1490>
                     │    └ <function log_middleware at 0x000001FD346D1F80>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001FD3571F1D0>

> File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\hooks\middlewares.py", line 9, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001FD357F1490>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001FD357CBA60>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001FD3581F420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001FD357CBC40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001FD3578CFE0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001FD3571F1D0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001FD3581F420>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001FD357CBC40>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001FD357F3B60>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001FD343CCC50>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001FD3578CFE0>
          └ <function wrap_app_handling_exceptions at 0x000001FD343F9A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001FD35858E00>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001FD357CBC40>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001FD343CCC50>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001FD35858E00>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001FD357CBC40>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001FD343CCC50>>
          └ <fastapi.routing.APIRouter object at 0x000001FD343CCC50>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001FD35858E00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001FD357CBC40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001FD343FAE80>
          └ APIRoute(path='/address/detail/{id}', name='update_address', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001FD35858E00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001FD357CBC40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001FD357C91C0>
          └ APIRoute(path='/address/detail/{id}', name='update_address', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001FD35858E00>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001FD357CBC40>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001FD35836840>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001FD35858EA0>
          └ <function wrap_app_handling_exceptions at 0x000001FD343F9A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001FD35858FE0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001FD357CBC40>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001FD35858EA0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001FD35836840>
                     └ <function get_request_handler.<locals>.app at 0x000001FD357C93A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 296, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x000001FD343F93A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'model_attributes_type', 'loc': ('response',), 'msg': 'Input should be a valid dictionary or object to extract fields from', 'input': <coroutine object AddressServiceClient.get_address_by_id at 0x000001FD35787440>}

2024-08-13 20:26:28.565 | ERROR    | hooks.middlewares:log_middleware:14 - 发生异常了！
Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 105, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001B828943CE0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 100, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    return receiver.item
           └ <unprintable MemoryObjectItemReceiver object>

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001B828943D80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 120, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 340
               │     └ 3
               └ <function _main at 0x000001B8264E2FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 340
           │    └ <function BaseProcess._bootstrap at 0x000001B826444860>
           └ <SpawnProcess name='SpawnProcess-1' parent=15952 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001B826437D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=15952 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001B8264D18B0>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=15952 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=15952 started>
    │    └ <function subprocess_started at 0x000001B828835DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=15952 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=440, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001B828975670>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=440, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001B8288353A0>
           │       │   └ <uvicorn.server.Server object at 0x000001B828975670>
           │       └ <function run at 0x000001B8280362A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001B8289791C0>
           │      └ <function Runner.run at 0x000001B828100FE0>
           └ <asyncio.runners.Runner object at 0x000001B8264D1AF0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001B8280FEC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001B8264D1AF0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001B8280FEB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001B8281009A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001B828036FC0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001B828B50950>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B82B...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001B828B020C0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001B828B50950>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B82B...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B82B...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001B82B9F7380>
          └ <fastapi.applications.FastAPI object at 0x000001B828B020C0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001B82BD479C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001B...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001B82BD2EE40>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001B82B9F7380>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001B82BD47A60>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001B82BD71100>
                     │    └ <function log_middleware at 0x000001B82AC51F80>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001B82BD2EE40>

> File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\hooks\middlewares.py", line 9, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001B82BD71100>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001B82BD47A60>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
          └ AttributeError("'UnaryUnaryCall' object has no attribute 'address'")
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001B82BD9F420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B82BD47C40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001B8288B59A0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001B82BD2EE40>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001B82BD9F420>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B82BD47C40>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001B82BD4F590>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001B82AA0E4E0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001B8288B59A0>
          └ <function wrap_app_handling_exceptions at 0x000001B82A979A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B82BDD8E00>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B82BD47C40>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001B82AA0E4E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B82BDD8E00>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B82BD47C40>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001B82AA0E4E0>>
          └ <fastapi.routing.APIRouter object at 0x000001B82AA0E4E0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B82BDD8E00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B82BD47C40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001B82A97AE80>
          └ APIRoute(path='/address/detail/{id}', name='update_address', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B82BDD8E00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B82BD47C40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001B82BD451C0>
          └ APIRoute(path='/address/detail/{id}', name='update_address', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B82BDD8E00>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B82BD47C40>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001B82BDB64E0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001B82BDD8EA0>
          └ <function wrap_app_handling_exceptions at 0x000001B82A979A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001B82BDD8FE0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001B82BD47C40>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001B82BDD8EA0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001B82BDB64E0>
                     └ <function get_request_handler.<locals>.app at 0x000001B82BD453A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001B82A979260>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_id': 1823301044390592512, 'id': '75fd40e200bb475c9151ace1788f63af'}
                 │         └ <function update_address at 0x000001B82BD17420>
                 └ <fastapi.dependencies.models.Dependant object at 0x000001B82BD4C860>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\routers\address.py", line 47, in update_address
    address = await address_service_client.get_address_by_id(user_id, id)
                    │                      │                 │        └ '75fd40e200bb475c9151ace1788f63af'
                    │                      │                 └ 1823301044390592512
                    │                      └ <function AddressServiceClient.get_address_by_id at 0x000001B82BD16160>
                    └ <services.address.AddressServiceClient object at 0x000001B82BD0F410>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\services\decorators.py", line 12, in wrapper
    result = await func(*args, **kwargs)
                   │     │       └ {}
                   │     └ (<services.address.AddressServiceClient object at 0x000001B82BD0F410>, 1823301044390592512, '75fd40e200bb475c9151ace1788f63af')
                   └ <function AddressServiceClient.get_address_by_id at 0x000001B82BD160C0>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\services\address.py", line 74, in get_address_by_id
    return response.address
           └ <_AioCall of RPC that terminated with:
             	status = Locally cancelled by application!
             	details = "StatusCode.CANCELLED"
             	debug_e...

AttributeError: 'UnaryUnaryCall' object has no attribute 'address'
2024-08-13 20:29:54.295 | ERROR    | hooks.middlewares:log_middleware:14 - 发生异常了！
Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 105, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000002697AA73CE0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 100, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    return receiver.item
           └ <unprintable MemoryObjectItemReceiver object>

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000002697AA73D80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 120, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 364
               │     └ 3
               └ <function _main at 0x00000269785A2FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 364
           │    └ <function BaseProcess._bootstrap at 0x0000026978504860>
           └ <SpawnProcess name='SpawnProcess-1' parent=16228 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x00000269784F7D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=16228 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x0000026978591850>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=16228 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=16228 started>
    │    └ <function subprocess_started at 0x000002697A961DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=16228 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000002697AAA5610>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=824, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000002697A9613A0>
           │       │   └ <uvicorn.server.Server object at 0x000002697AAA5610>
           │       └ <function run at 0x000002697A1362A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002697AAA91C0>
           │      └ <function Runner.run at 0x000002697A210FE0>
           └ <asyncio.runners.Runner object at 0x000002697A8DE930>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002697A20EC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002697A8DE930>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002697A20EB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002697A2109A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002697A136FC0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002697AC80680>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002697D...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000026...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002697AAF20C0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002697AC80680>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002697D...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000026...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000002697D...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000026...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002697CF21BE0>
          └ <fastapi.applications.FastAPI object at 0x000002697AAF20C0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002697DEC8180>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000026...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002697D3BF830>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002697CF21BE0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002697DE48680>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000002697DEAC560>
                     │    └ <function log_middleware at 0x000002697CD81F80>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002697D3BF830>

> File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\hooks\middlewares.py", line 9, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000002697DEAC560>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002697DE48680>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
          └ AttributeError("'UnaryUnaryCall' object has no attribute 'addresses'")
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002697DECBBA0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002697DEC8360>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002697DB24140>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002697D3BF830>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002697DECBBA0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002697DEC8360>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000002697DEAFE30>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000002697CBAC7A0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002697DB24140>
          └ <function wrap_app_handling_exceptions at 0x000002697CAA9A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002697DF0D580>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002697DEC8360>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000002697CBAC7A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002697DF0D580>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002697DEC8360>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000002697CBAC7A0>>
          └ <fastapi.routing.APIRouter object at 0x000002697CBAC7A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002697DF0D580>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002697DEC8360>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002697CAAAE80>
          └ APIRoute(path='/address/list', name='update_address', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002697DF0D580>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002697DEC8360>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002697DE7CF40>
          └ APIRoute(path='/address/list', name='update_address', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002697DF0D580>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002697DEC8360>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000002697DEE3F80>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000002697DF0D620>
          └ <function wrap_app_handling_exceptions at 0x000002697CAA9A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002697DF0D760>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002697DEC8360>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000002697DF0D620>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000002697DEE3F80>
                     └ <function get_request_handler.<locals>.app at 0x000002697DE7CCC0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002697CAA9260>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'user_id': 1823301044390592512, 'page': 1, 'size': 20}
                 │         └ <function update_address at 0x000002697DE4AFC0>
                 └ <fastapi.dependencies.models.Dependant object at 0x000002697DE84CE0>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\routers\address.py", line 53, in update_address
    addresses = await address_service_client.get_address_list(user_id, page=page, size=size)
                      │                      │                │             │          └ 20
                      │                      │                │             └ 1
                      │                      │                └ 1823301044390592512
                      │                      └ <function AddressServiceClient.get_address_list at 0x000002697DE1B9C0>
                      └ <services.address.AddressServiceClient object at 0x000002697D5FCAA0>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\services\decorators.py", line 12, in wrapper
    result = await func(*args, **kwargs)
                   │     │       └ {'page': 1, 'size': 20}
                   │     └ (<services.address.AddressServiceClient object at 0x000002697D5FCAA0>, 1823301044390592512)
                   └ <function AddressServiceClient.get_address_list at 0x000002697DE4A2A0>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\services\address.py", line 81, in get_address_list
    return response.addresses
           └ <_AioCall of RPC that terminated with:
             	status = Locally cancelled by application!
             	details = "StatusCode.CANCELLED"
             	debug_e...

AttributeError: 'UnaryUnaryCall' object has no attribute 'addresses'
2024-08-13 20:30:30.692 | ERROR    | hooks.middlewares:log_middleware:14 - 发生异常了！
Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 105, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x000001EC3B0A3CE0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 100, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    return receiver.item
           └ <unprintable MemoryObjectItemReceiver object>

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001EC3B0A3D80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 120, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 352
               │     └ 3
               └ <function _main at 0x000001EC38BB2FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 352
           │    └ <function BaseProcess._bootstrap at 0x000001EC38B14860>
           └ <SpawnProcess name='SpawnProcess-1' parent=24472 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000001EC38B07D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=24472 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000001EC38BA1850>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24472 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=24472 started>
    │    └ <function subprocess_started at 0x000001EC3AF91DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=24472 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=544, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x000001EC3B0D5610>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=544, family=2, type=1, proto=6, laddr=('127.0.0.1', 8000)>]
           │       │   │    └ <function Server.serve at 0x000001EC3AF913A0>
           │       │   └ <uvicorn.server.Server object at 0x000001EC3B0D5610>
           │       └ <function run at 0x000001EC3A7662A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001EC3B0D91C0>
           │      └ <function Runner.run at 0x000001EC3A840FE0>
           └ <asyncio.runners.Runner object at 0x000001EC3AF0E930>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001EC3A83EC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001EC3AF0E930>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001EC3A83EB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001EC3A8409A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001EC3A766FC0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001EC3B2B0680>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001EC3E...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001EC3BDFEA50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001EC3B2B0680>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001EC3E...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001EC3E...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001EC3E4E0E60>
          └ <fastapi.applications.FastAPI object at 0x000001EC3BDFEA50>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001EC3E4F8180>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x000001E...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001EC3E4E1070>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001EC3E4E0E60>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001EC3E4785E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001EC3E4E0890>
                     │    └ <function log_middleware at 0x000001EC3D3B1F80>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001EC3E4E1070>

> File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\hooks\middlewares.py", line 9, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001EC3E4E0890>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001EC3E4785E0>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001EC3E4FBBA0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001EC3E4F8360>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001EC3E4E1010>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001EC3E4E1070>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001EC3E4FBBA0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001EC3E4F8360>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001EC3E504380>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001EC3D3B4CB0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001EC3E4E1010>
          └ <function wrap_app_handling_exceptions at 0x000001EC3D0D9A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EC3E53D580>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001EC3E4F8360>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001EC3D3B4CB0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EC3E53D580>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001EC3E4F8360>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001EC3D3B4CB0>>
          └ <fastapi.routing.APIRouter object at 0x000001EC3D3B4CB0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EC3E53D580>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001EC3E4F8360>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001EC3D0DAE80>
          └ APIRoute(path='/address/list', name='update_address', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EC3E53D580>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001EC3E4F8360>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001EC3E4B0CC0>
          └ APIRoute(path='/address/list', name='update_address', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EC3E53D580>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001EC3E4F8360>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001EC3E5401A0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001EC3E53D620>
          └ <function wrap_app_handling_exceptions at 0x000001EC3D0D9A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001EC3E53D760>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001EC3E4F8360>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001EC3E53D620>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x000001EC3E5401A0>
                     └ <function get_request_handler.<locals>.app at 0x000001EC3E4B0C20>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 296, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x000001EC3D0D93A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 155, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'addresses'), 'msg': 'Field required', 'input': [id: "75fd40e200bb475c9151ace1788f63af"
realname: "李四"
mobile: "18899991111"
region: "北京市朝阳区"
detail: "xx路"
]}

2024-08-14 11:39:09.197 | ERROR    | hooks.middlewares:log_middleware:14 - 发生异常了！
Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 105, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000022820DA3CE0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 100, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    return receiver.item
           └ <unprintable MemoryObjectItemReceiver object>

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000022820DA3D80>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 120, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 122, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 356
               │     └ 3
               └ <function _main at 0x000002281E902FC0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\spawn.py", line 135, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 356
           │    └ <function BaseProcess._bootstrap at 0x000002281E864860>
           └ <SpawnProcess name='SpawnProcess-1' parent=20080 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x000002281E857D80>
    └ <SpawnProcess name='SpawnProcess-1' parent=20080 started>
  File "D:\LenovoSoftstore\Program\Python312\Lib\multiprocessing\process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x000002281E8F1850>, 'target': <bound method Server.run of <uvicorn.server.Server...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20080 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20080 started>
    │    └ <function subprocess_started at 0x0000022820C95DA0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20080 started>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=560, family=2, type=1, proto=6, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x0000022820DD5670>>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=560, family=2, type=1, proto=6, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x0000022820C953A0>
           │       │   └ <uvicorn.server.Server object at 0x0000022820DD5670>
           │       └ <function run at 0x00000228204662A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000022820DD91C0>
           │      └ <function Runner.run at 0x0000022820540FE0>
           └ <asyncio.runners.Runner object at 0x0000022820C93740>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002282053EC00>
           │    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000022820C93740>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002282053EB60>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000228205409A0>
    └ <_WindowsSelectorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000022820466FC0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000022823E44FE0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022824...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000022820FB0AD0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000022823E44FE0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022824...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022824...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000022824209C70>
          └ <fastapi.applications.FastAPI object at 0x0000022820FB0AD0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000022824216980>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000022...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000022824209EB0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000022824209C70>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000022824216840>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000022824271B50>
                     │    └ <function log_middleware at 0x00000228232DC400>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000022824209EB0>

> File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\hooks\middlewares.py", line 9, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000022824271B50>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000022824216840>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
          └ ConnectionError("Error Multiple exceptions: [Errno 10061] Connect call failed ('::1', 6379, 0, 0), [Errno 10061] Connect call...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000022824283B00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000228242168E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000228241EB320>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000022824209EB0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000022824283B00>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000228242168E0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000228242717F0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000228232A3860>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000228241EB320>
          └ <function wrap_app_handling_exceptions at 0x0000022822DD9A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022824283C40>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000228242168E0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000228232A3860>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022824283C40>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000228242168E0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000228232A3860>>
          └ <fastapi.routing.APIRouter object at 0x00000228232A3860>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022824283C40>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000228242168E0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000022822DDAE80>
          └ APIRoute(path='/user/smscode/{mobile}', name='get_smscode', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022824283C40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000228242168E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000228241D2340>
          └ APIRoute(path='/user/smscode/{mobile}', name='get_smscode', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022824283C40>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000228242168E0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000022824271AC0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000022824283CE0>
          └ <function wrap_app_handling_exceptions at 0x0000022822DD9A80>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000022824283E20>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000228242168E0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000022824283CE0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000022824271AC0>
                     └ <function get_request_handler.<locals>.app at 0x00000228241D22A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000022822DD9260>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'mobile': '18899990000'}
                 │         └ <function get_smscode at 0x0000022824182FC0>
                 └ <fastapi.dependencies.models.Dependant object at 0x00000228241BCD10>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\routers\user.py", line 26, in get_smscode
    await tll_redis.set_sms_code(mobile, code)
          │         │            │       └ '1394'
          │         │            └ '18899990000'
          │         └ <function TLLRedis.set_sms_code at 0x00000228230B4A40>
          └ <utils.cache.TLLRedis object at 0x0000022823EA5970>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\utils\cache.py", line 21, in set_sms_code
    await self.set(self.SMS_CODE_PREFIX.format(mobile), code)
          │    │   │    │               │      │        └ '1394'
          │    │   │    │               │      └ '18899990000'
          │    │   │    │               └ <method 'format' of 'str' objects>
          │    │   │    └ 'sms_code_{}'
          │    │   └ <utils.cache.TLLRedis object at 0x0000022823EA5970>
          │    └ <function TLLRedis.set at 0x0000022822EC7EC0>
          └ <utils.cache.TLLRedis object at 0x0000022823EA5970>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\utils\cache.py", line 12, in set
    await self.client.set(key, value, ex)
          │    │      │   │    │      └ 18000
          │    │      │   │    └ '1394'
          │    │      │   └ 'sms_code_18899990000'
          │    │      └ <function BasicKeyCommands.set at 0x0000022823038D60>
          │    └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port...
          └ <utils.cache.TLLRedis object at 0x0000022823EA5970>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\client.py", line 610, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
           │    │                   │    │              │               └ {}
           │    │                   │    │              └ 'SET'
           │    │                   │    └ <function ConnectionPool.get_connection at 0x0000022822F7ED40>
           │    │                   └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>)>
           │    └ None
           └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 1049, in get_connection
    await self.ensure_connection(connection)
          │    │                 └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          │    └ <function ConnectionPool.ensure_connection at 0x0000022822F7EFC0>
          └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 1082, in ensure_connection
    await connection.connect()
          │          └ <function AbstractConnection.connect at 0x0000022822F7D120>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 284, in connect
    raise ConnectionError(self._error_message(e))
          │               │    └ <function AbstractConnection._error_message at 0x0000022822F7D300>
          │               └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          └ <class 'redis.exceptions.ConnectionError'>

redis.exceptions.ConnectionError: Error Multiple exceptions: [Errno 10061] Connect call failed ('::1', 6379, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 6379) connecting to localhost:6379.
2024-08-15 19:53:19.815 | ERROR    | hooks.middlewares:log_middleware:14 - 发生异常了！
Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 105, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000013523820360>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 100, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 118, in receive
    return receiver.item
           └ <unprintable MemoryObjectItemReceiver object>

AttributeError: 'MemoryObjectItemReceiver' object has no attribute 'item'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000013523820400>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\anyio\streams\memory.py", line 120, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\main.py", line 37, in <module>
    uvicorn.run(app, host='0.0.0.0', port=settings.SERVER_PORT)
    │       │   │                         │        └ 8000
    │       │   │                         └ <module 'settings' from 'D:\\work\\VIPCourse\\codes\\python_django\\taolele\\tll\\user_api\\settings\\__init__.py'>
    │       │   └ <fastapi.applications.FastAPI object at 0x0000013520807B30>
    │       └ <function run at 0x00000135261CA020>
    └ <module 'uvicorn' from 'C:\\Users\\paofu\\Envs\\tll-env\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\main.py", line 577, in run
    server.run()
    │      └ <function Server.run at 0x00000135261CA3E0>
    └ <uvicorn.server.Server object at 0x00000135262524B0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py", line 65, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x00000135261CA480>
           │       │   └ <uvicorn.server.Server object at 0x00000135262524B0>
           │       └ <function run at 0x000001352089C4A0>
           └ <module 'asyncio' from 'D:\\LenovoSoftstore\\Program\\Python312\\Lib\\asyncio\\__init__.py'>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 194, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000135262225E0>
           │      └ <function Runner.run at 0x00000135224F0540>
           └ <asyncio.runners.Runner object at 0x00000135262509E0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\server.py:6...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000135224EE160>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000135262509E0>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 672, in run_until_complete
    self.run_forever()
    │    └ <function ProactorEventLoop.run_forever at 0x00000135225A99E0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\windows_events.py", line 321, in run_forever
    super().run_forever()
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 639, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000135224EFEC0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\base_events.py", line 1985, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000013522488360>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "D:\LenovoSoftstore\Program\Python312\Lib\asyncio\events.py", line 88, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\protocols\http\httptools_impl.py", line 399, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000013526228F50>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 70, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000013526...
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000013...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000013520807B30>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000013526228F50>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000013526...
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000013...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\applications.py", line 123, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000013526...
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000013...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000135262DB830>
          └ <fastapi.applications.FastAPI object at 0x0000013520807B30>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001352632F420>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.httptools_impl.RequestResponseCycle object at 0x0000013...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000135262DB7D0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000135262DB830>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 191, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000135263BD800>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000013526385E50>
                     │    └ <function log_middleware at 0x000001352517D6C0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000135262DB7D0>

> File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\hooks\middlewares.py", line 9, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000013526385E50>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000135263BD800>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 165, in call_next
    raise app_exc
          └ ConnectionError('Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.')
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\base.py", line 151, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000135263BD8A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000135263BCEA0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000135262DB800>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000135262DB7D0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\middleware\exceptions.py", line 65, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000135263BD8A0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000135263BCEA0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000135263862A0>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000135260438C0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000135262DB800>
          └ <function wrap_app_handling_exceptions at 0x0000013524A6AAC0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000135263BD4E0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000135263BCEA0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000135260438C0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 756, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000135263BD4E0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000135263BCEA0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000135260438C0>>
          └ <fastapi.routing.APIRouter object at 0x00000135260438C0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 776, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000135263BD4E0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000135263BCEA0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000013524A6BEC0>
          └ APIRoute(path='/user/smscode/{mobile}', name='get_smscode', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 297, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000135263BD4E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000135263BCEA0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001352620BB00>
          └ APIRoute(path='/user/smscode/{mobile}', name='get_smscode', methods=['GET'])
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 77, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000135263BD4E0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000135263BCEA0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000013526386780>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000135263BCC20>
          └ <function wrap_app_handling_exceptions at 0x0000013524A6AAC0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 64, in wrapped_app
    raise exc
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000135263BD260>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000135263BCEA0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.4'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000135263BCC20>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\starlette\routing.py", line 72, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x0000013526386780>
                     └ <function get_request_handler.<locals>.app at 0x000001352620BA60>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 278, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000013524A6A2A0>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\fastapi\routing.py", line 191, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'mobile': '18899990000'}
                 │         └ <function get_smscode at 0x000001352517D760>
                 └ <fastapi.dependencies.models.Dependant object at 0x0000013526206F60>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\routers\user.py", line 26, in get_smscode
    await tll_redis.set_sms_code(mobile, code)
          │         │            │       └ '8601'
          │         │            └ '18899990000'
          │         └ <function TLLRedis.set_sms_code at 0x0000013524DCC860>
          └ <utils.cache.TLLRedis object at 0x0000013525D43FE0>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\utils\cache.py", line 21, in set_sms_code
    await self.set(self.SMS_CODE_PREFIX.format(mobile), code)
          │    │   │    │               │      │        └ '8601'
          │    │   │    │               │      └ '18899990000'
          │    │   │    │               └ <method 'format' of 'str' objects>
          │    │   │    └ 'sms_code_{}'
          │    │   └ <utils.cache.TLLRedis object at 0x0000013525D43FE0>
          │    └ <function TLLRedis.set at 0x0000013524BF7D80>
          └ <utils.cache.TLLRedis object at 0x0000013525D43FE0>

  File "D:\work\VIPCourse\codes\python_django\taolele\tll\user_api\utils\cache.py", line 12, in set
    await self.client.set(key, value, ex)
          │    │      │   │    │      └ 18000
          │    │      │   │    └ '8601'
          │    │      │   └ 'sms_code_18899990000'
          │    │      └ <function BasicKeyCommands.set at 0x0000013524D4CCC0>
          │    └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port...
          └ <utils.cache.TLLRedis object at 0x0000013525D43FE0>

  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\client.py", line 610, in execute_command
    conn = self.connection or await pool.get_connection(command_name, **options)
           │    │                   │    │              │               └ {}
           │    │                   │    │              └ 'SET'
           │    │                   │    └ <function ConnectionPool.get_connection at 0x0000013524CA2CA0>
           │    │                   └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>)>
           │    └ None
           └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port...
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 1049, in get_connection
    await self.ensure_connection(connection)
          │    │                 └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          │    └ <function ConnectionPool.ensure_connection at 0x0000013524CA2F20>
          └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 1082, in ensure_connection
    await connection.connect()
          │          └ <function AbstractConnection.connect at 0x0000013524CA1080>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "C:\Users\paofu\Envs\tll-env\Lib\site-packages\redis\asyncio\connection.py", line 284, in connect
    raise ConnectionError(self._error_message(e))
          │               │    └ <function AbstractConnection._error_message at 0x0000013524CA1260>
          │               └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          └ <class 'redis.exceptions.ConnectionError'>

redis.exceptions.ConnectionError: Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.
2024-08-15 21:05:50.729 | INFO     | services.user:user_service_addr:18 - 获取到的地址：192.168.0.16:51399
2024-08-15 21:06:18.934 | INFO     | services.user:user_service_addr:18 - 获取到的地址：192.168.0.16:51409
